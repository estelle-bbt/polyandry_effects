geom_density(alpha=0.6) +
ggtitle("Flower scale") +
scale_fill_manual(values = c("#A3333D","#CA755E","#f0b67f")) +
scale_color_manual(values = c("#A3333D","#CA755E","#f0b67f")) +
geom_vline(data=mu_flo_oms, aes(xintercept=mean, color=poll_treat_factor),
linetype="dashed")
plot_flo_oms
mu_flo_oms
dt_flo_raw <- dt |>
select(ID_full, poll_treat_factor, id_flow, gMS_fem_out, import_nb_part_ID_out_co10) |>
rename(ms_gms = gMS_fem_out,
ms_oms = import_nb_part_ID_out_co10)
dt_flo <- dt_flo_raw |>
pivot_longer(
cols = starts_with("ms"),
names_to = c("ms"),
names_pattern = "ms_(gms|oms)"
)
mu_flo <- dt_flo_raw |>
group_by(poll_treat_factor) |>
summarise(mean_gms = mean(ms_gms,na.rm = T),
sd_gms = sd(ms_gms,na.rm = T),
mean_oms = mean(ms_oms,na.rm = T),
sd_oms = sd(ms_oms,na.rm = T)) |>
pivot_longer(
cols = -poll_treat_factor,
names_to = c(".value", "ms"),
names_pattern = "(mean|sd)_(.*)"
)
dt_flo$ms <- factor(dt_flo$ms, levels = c("oms", "gms"))
plot_flo <- ggplot(data = dt_flo, aes(x = value, fill = poll_treat_factor)) +
theme_classic() +
theme(legend.position = "none") +
facet_wrap(ms ~ ., ncol = 1, as.table = FALSE) +
geom_histogram(aes(y=after_stat(density)),alpha=0.5) +
geom_density(alpha=0.6) +
ggtitle("Flower scale") +
scale_fill_manual(values = c("#A3333D","#CA755E","#f0b67f")) +
scale_color_manual(values = c("#A3333D","#CA755E","#f0b67f")) +
geom_vline(data=mu_flo, aes(xintercept=mean, color=poll_treat_factor),
linetype="dashed")
plot_flo
mu_flo_oms <- dt_flo_raw |>
group_by(poll_treat_factor) |>
summarise(mean = mean(ms_oms,na.rm = T),
sd = sd(ms_oms,na.rm = T))
plot_flo_oms <- ggplot(data = dt_flo, aes(x = value, fill = poll_treat_factor)) +
theme_classic() +
theme(legend.position = "none") +
geom_histogram(aes(y=after_stat(density)),alpha=0.5) +
geom_density(alpha=0.6) +
ggtitle("Flower scale") +
scale_fill_manual(values = c("#A3333D","#CA755E","#f0b67f")) +
scale_color_manual(values = c("#A3333D","#CA755E","#f0b67f")) +
geom_vline(data=mu_flo_oms, aes(xintercept=mean, color=poll_treat_factor),
linetype="dashed")
plot_flo_oms
plot_flo_oms <- ggplot(data = dt_flo %>% filter(ms == "oms"), aes(x = value, fill = poll_treat_factor)) +
theme_classic() +
theme(legend.position = "none") +
geom_histogram(aes(y=after_stat(density)),alpha=0.5) +
geom_density(alpha=0.6) +
ggtitle("Flower scale") +
scale_fill_manual(values = c("#A3333D","#CA755E","#f0b67f")) +
scale_color_manual(values = c("#A3333D","#CA755E","#f0b67f")) +
geom_vline(data=mu_flo_oms, aes(xintercept=mean, color=poll_treat_factor),
linetype="dashed")
plot_flo_oms
2^0.5
164+70
159+49
#' Project builder
## Install Dependencies (listed in DESCRIPTION) ----
remotes::install_deps(upgrade = "never")
## Run Project ----
targets::tar_make()
targets::tar_load(data_flower)
View(data_flower)
file_path = "data/data_ABPOLL_ID_level_detflo.txt"
read.table(file_path,head=T)
# observation with observed visits only (carry-over 10)
obs_only <- read.table(file_path,head=T) %>%
filter(!session %in% c("5.FA1","5.MO1"))  %>%
select(session,ID_full_foc,ID_full_part,id_flow_part,export_nb_visit_co10) %>%
filter(!(is.na(export_nb_visit_co10)|export_nb_visit_co10==0)) %>%
mutate(couple_obs = paste0(ID_full_foc,"_",id_flow_part))
library(tidyverse)
# observation with observed visits only (carry-over 10)
obs_only <- read.table(file_path,head=T) %>%
filter(!session %in% c("5.FA1","5.MO1"))  %>%
select(session,ID_full_foc,ID_full_part,id_flow_part,export_nb_visit_co10) %>%
filter(!(is.na(export_nb_visit_co10)|export_nb_visit_co10==0)) %>%
mutate(couple_obs = paste0(ID_full_foc,"_",id_flow_part))
# observation with observed visits only (carry-over 10)
obs_only <- read.table(file_path,head=T) %>%
filter(!session %in% c("5.FA1","5.MO1"))  %>%
select(session,ID_full_foc,ID_full_part,id_flow_part,export_nb_visit_co10) %>%
filter(!(is.na(export_nb_visit_co10)|export_nb_visit_co10==0)) %>%
mutate(couple_obs = paste0(ID_full_foc,"_",id_flow_part))
obs_only
file_path_obs = "data/data_ABPOLL_ID_level_detflo.txt"
file_path_genot = "data/fix10_paternities_ABPOLL.txt"
# couples with observed visits only (carry-over 10)
obs_only <- read.table(file_path_obs,head=T) %>%
filter(!session %in% c("5.FA1","5.MO1"))  %>%
select(session,ID_full_foc,ID_full_part,id_flow_part,export_nb_visit_co10) %>%
filter(!(is.na(export_nb_visit_co10)|export_nb_visit_co10==0)) %>%
mutate(couple_obs = paste0(ID_full_foc,"_",id_flow_part))
read.table(file_path_gen,head=T)
file_path_gen = "data/fix10_paternities_ABPOLL.txt"
read.table(file_path_gen,head=T)
obs_only
gen_only
read.table(file_path_gen,head=T)
read.table(file_path_gen,head=T) |>
mutate(offspring_id_clean = stringr::str_extract(offspring_id, "_run3"))
read.table(file_path_gen,head=T)
read.table(file_path_gen,head=T) |>
mutate(offspring_id_clean = stringr::str_extract(offspring_id, "_run3"))
read.table(file_path_gen,head=T)
t <- read.table(file_path_gen,head=T) |>
mutate(offspring_id_clean = stringr::str_extract(offspring_id, "_run3"))
View(t)
t <- read.table(file_path_gen,head=T) |>
mutate(offspring_id_clean = stringr::str_remove(offspring_id, "_run3"))
?str_remove
t <- read.table(file_path_gen,head=T) |>
mutate(offspring_id_clean = stringr::str_remove(offspring_id, pattern = c("_run3","a"))
return(x)
t <- read.table(file_path_gen,head=T) |>
mutate(offspring_id_clean = stringr::str_remove(offspring_id, pattern = c("_run3"))
return(x)
t <- read.table(file_path_gen,head=T) |>
mutate(offspring_id_clean = stringr::str_remove(offspring_id, pattern = c("_run3")))
t <- read.table(file_path_gen,head=T) |>
mutate(offspring_id_clean = stringr::str_remove(offspring_id, pattern = c("_run3","a")))
t <- read.table(file_path_gen,head=T) |>
mutate(offspring_id_clean = stringr::str_remove(offspring_id, pattern = list("_run3","a")))
t <- read.table(file_path_gen,head=T) |>
mutate(offspring_id_clean = stringr::str_remove(offspring_id, pattern = "_run3|a"))
remove <- c("@\\w+", "http\\w+", "[[:punct:]]")
paste(remove, collapse = "|")
t <- read.table(file_path_gen,head=T) |>
mutate(offspring_id_clean = stringr::str_remove(offspring_id, pattern = "_run3|a"))
t <- read.table(file_path_gen,head=T) |>
mutate(offspring_id_clean = stringr::str_remove(offspring_id, pattern = "_run3||a"))
t <- read.table(file_path_gen,head=T) |>
mutate(offspring_id = stringr::str_remove(offspring_id, pattern = "_run3"),
offspring_id = stringr::str_remove(offspring_id, pattern = "a"),
offspring_id = stringr::str_remove(offspring_id, pattern = "b"))
t <- read.table(file_path_gen,head=T) |>
mutate(offspring_id = stringr::str_remove(offspring_id, pattern = "_run3"),
offspring_id = stringr::str_remove(offspring_id, pattern = "a"),
offspring_id = stringr::str_remove(offspring_id, pattern = "b")) |>
mutate(test = sub("_[^_]+$", "", offspring_id))
t <- read.table(file_path_gen,head=T) |>
mutate(offspring_id = stringr::str_remove(offspring_id, pattern = "_run3"),
offspring_id = stringr::str_remove(offspring_id, pattern = "a"),
offspring_id = stringr::str_remove(offspring_id, pattern = "b")) |>
mutate(offspring_id = sub("_[^_]+$", "", offspring_id))
t <- read.table(file_path_gen,head=T) |>
mutate(offspring_id = stringr::str_remove(offspring_id, pattern = "_run3"),
offspring_id = stringr::str_remove(offspring_id, pattern = "a"),
offspring_id = stringr::str_remove(offspring_id, pattern = "b")) |>
mutate(flower_id = sub("_[^_]+$", "", offspring_id)) |>
mutate(couple_gen = paste0(candidate_id,"_",flower_id))
obs_only
# couples with observed visits only (carry-over 10)
obs_only <- read.table(file_path_obs,head=T) %>%
filter(!session %in% c("5.FA1","5.MO1"))  %>%
select(session,ID_full_foc,ID_full_part,id_flow_part,export_nb_visit_co10) %>%
filter(!(is.na(export_nb_visit_co10)|export_nb_visit_co10==0)) %>%
mutate(couple_obs = paste0(ID_full_foc,"_",id_flow_part))
# filtering only observed contact
gen_only <- read.table(file_path_gen,head=T) |>
mutate(offspring_id = stringr::str_remove(offspring_id, pattern = "_run3"),
offspring_id = stringr::str_remove(offspring_id, pattern = "a"),
offspring_id = stringr::str_remove(offspring_id, pattern = "b")) |>
mutate(flower_id = sub("_[^_]+$", "", offspring_id)) |>
mutate(couple_gen = paste0(candidate_id,"_",flower_id)) |>
filter(couple_gen %in% obs_only$couple_obs)
gen_only
oms_gms_flower <- obs_clean |>
group_by(ID_full_part,id_flow_part) |>
summarise(oms = n_distinct(ID_full_foc))
# couples with observed visits only (carry-over 10)
obs_clean <- read.table(file_path_obs,head=T) %>%
filter(!session %in% c("5.FA1","5.MO1"))  %>%
select(session,ID_full_foc,ID_full_part,id_flow_part,export_nb_visit_co10) %>%
filter(!(is.na(export_nb_visit_co10)|export_nb_visit_co10==0)) %>%
mutate(couple_obs = paste0(ID_full_foc,"_",id_flow_part))
# filtering only observed contact
gen_clean <- read.table(file_path_gen,head=T) |>
mutate(offspring_id = stringr::str_remove(offspring_id, pattern = "_run3"),
offspring_id = stringr::str_remove(offspring_id, pattern = "a"),
offspring_id = stringr::str_remove(offspring_id, pattern = "b")) |>
mutate(flower_id = sub("_[^_]+$", "", offspring_id)) |>
mutate(couple_gen = paste0(candidate_id,"_",flower_id)) |>
filter(couple_gen %in% obs_only$couple_obs)
oms_gms_flower <- obs_clean |>
group_by(ID_full_part,id_flow_part) |>
summarise(oms = n_distinct(ID_full_foc))
oms_gms_flower
oms_gms_flower <- obs_clean |>
group_by(ID_full_part,id_flow_part) |>
summarise(oms = n_distinct(ID_full_foc)) |>
rename(id = ID_full_part,
id_flow = id_flow_part)
oms_gms_flower
gen_clean
gen_clean <- read.table(file_path_gen,head=T) |>
mutate(offspring_id = stringr::str_remove(offspring_id, pattern = "_run3"),
offspring_id = stringr::str_remove(offspring_id, pattern = "a"),
offspring_id = stringr::str_remove(offspring_id, pattern = "b")) |>
mutate(flower_id = sub("_[^_]+$", "", offspring_id)) |>
mutate(couple_gen = paste0(candidate_id,"_",flower_id))
dim(gen_clean)
# filtering only observed contact
gen_clean <- read.table(file_path_gen,head=T) |>
mutate(offspring_id = stringr::str_remove(offspring_id, pattern = "_run3"),
offspring_id = stringr::str_remove(offspring_id, pattern = "a"),
offspring_id = stringr::str_remove(offspring_id, pattern = "b")) |>
mutate(flower_id = sub("_[^_]+$", "", offspring_id)) |>
mutate(couple_gen = paste0(candidate_id,"_",flower_id)) |>
filter(couple_gen %in% obs_only$couple_obs)
dim(gen_clean)
head(gen_clean)
oms_gms_flower <- obs_clean |>
group_by(ID_full_part,id_flow_part) |>
summarise(oms = n_distinct(ID_full_foc)) |>
rename(id = ID_full_part,
id_flow = id_flow_part) |>
left_join(gen_clean |>
group_by(known_id, flower_id) |>
summarise(gms = n_distinct(candidate_id)) |>
rename(id = known_id,
id_flow = flower_id))
oms_gms_flower
gen_clean |>
group_by(known_id, flower_id) |>
summarise(gms = n_distinct(candidate_id)) |>
rename(id = known_id,
id_flow = flower_id)
oms_gms_flower <- obs_clean |>
group_by(ID_full_part,id_flow_part) |>
summarise(oms = n_distinct(ID_full_foc)) |>
rename(id = ID_full_part,
id_flow = id_flow_part) |>
left_join(gen_clean |>
group_by(known_id, flower_id) |>
summarise(gms = n_distinct(candidate_id)) |>
rename(id = known_id,
id_flow = flower_id))
View(oms_gms_flower)
# couples with observed visits only (carry-over 10)
obs_clean <- read.table(file_path_obs,head=T) |>
filter(!session %in% c("5.FA1","5.MO1"))  |>
select(session,ID_full_foc,ID_full_part,id_flow_part,export_nb_visit_co10) |>
filter(ID_full_foc != ID_full_part)  |>
filter(!(is.na(export_nb_visit_co10)|export_nb_visit_co10==0)) |>
mutate(couple_obs = paste0(ID_full_foc,"_",id_flow_part))
# couples with observed visits only (carry-over 10)
obs_clean <- read.table(file_path_obs,head=T) |>
filter(!session %in% c("5.FA1","5.MO1"))  |>
select(session,ID_full_foc,ID_full_part,id_flow_part,export_nb_visit_co10) |>
filter(ID_full_foc != ID_full_part)  |>
filter(!(is.na(export_nb_visit_co10)|export_nb_visit_co10==0)) |>
mutate(couple_obs = paste0(ID_full_foc,"_",id_flow_part))
# filtering only observed contact
gen_clean <- read.table(file_path_gen,head=T) |>
filter(known_id != candidate_id) |>
mutate(offspring_id = stringr::str_remove(offspring_id, pattern = "_run3"),
offspring_id = stringr::str_remove(offspring_id, pattern = "a"),
offspring_id = stringr::str_remove(offspring_id, pattern = "b")) |>
mutate(flower_id = sub("_[^_]+$", "", offspring_id)) |>
mutate(couple_gen = paste0(candidate_id,"_",flower_id)) |>
filter(couple_gen %in% obs_only$couple_obs)
dim(gen_clean)
oms_gms_flower <- obs_clean |>
group_by(ID_full_part,id_flow_part) |>
summarise(oms = n_distinct(ID_full_foc)) |>
rename(id = ID_full_part,
id_flow = id_flow_part) |>
left_join(gen_clean |>
group_by(known_id, flower_id) |>
summarise(gms = n_distinct(candidate_id)) |>
rename(id = known_id,
id_flow = flower_id))
oms_gms_flower
# couples with observed visits only (carry-over 10)
obs_clean <- read.table(file_path_obs,head=T) |>
filter(!session %in% c("5.FA1","5.MO1"))  |>
select(session,ID_full_foc,ID_full_part,id_flow_part,export_nb_visit_co10) |>
filter(ID_full_foc != ID_full_part)  |>
filter(!(is.na(export_nb_visit_co10)|export_nb_visit_co10==0)) |>
mutate(couple_obs = paste0(ID_full_foc,"_",id_flow_part)) |>
rename(id = ID_full_part,
id_flow = id_flow_part)
# filtering only observed contact
gen_clean <- read.table(file_path_gen,head=T) |>
filter(known_id != candidate_id) |>
mutate(offspring_id = stringr::str_remove(offspring_id, pattern = "_run3"),
offspring_id = stringr::str_remove(offspring_id, pattern = "a"),
offspring_id = stringr::str_remove(offspring_id, pattern = "b")) |>
mutate(flower_id = sub("_[^_]+$", "", offspring_id)) |>
mutate(couple_gen = paste0(candidate_id,"_",flower_id)) |>
filter(couple_gen %in% obs_only$couple_obs)  |>
rename(id = known_id,
id_flow = flower_id)
oms_gms_flower <- obs_clean |>
group_by(ID_full_part,id_flow_part) |>
summarise(oms = n_distinct(ID_full_foc))  |>
left_join(gen_clean |>
group_by(known_id, flower_id) |>
summarise(gms = n_distinct(candidate_id)))
oms_gms_flower <- obs_clean |>
group_by(id,id_flow) |>
summarise(oms = n_distinct(ID_full_foc))  |>
left_join(gen_clean |>
group_by(id, id_flow) |>
summarise(gms = n_distinct(candidate_id)))
oms_gms_flower
oms_gms_id <- obs_clean |>
group_by(id) |>
summarise(oms = n_distinct(ID_full_foc))  |>
left_join(gen_clean |>
group_by(id) |>
summarise(gms = n_distinct(candidate_id)))
oms_gms_id
View(oms_gms_id)
View(data_flower)
group_by(ID_full,session,poll_treat_factor) %>%
summarise(nb_ab_sum_ab=sum(nbAv,na.rm=T),
nb_seed_sum_ab=sum(nbGr_SR,na.rm=T)))
group_by(ID_full,session,poll_treat_factor) %>%
summarise(nb_ab_sum_ab=sum(nbAv,na.rm=T),
nb_seed_sum_ab=sum(nbGr_SR,na.rm=T))
data_flower <- read.table(file_path,head=T) |>
mutate(ttt=as.factor(case_when(poll_treat==1~"low",
poll_treat==2~"medium",
TRUE~"high"))) |>
mutate(ttt=forcats::fct_relevel(ttt, c("low","medium","high")))
file_path = "data/data_ABPOLL_flower_resume.txt"
data_flower <- read.table(file_path,head=T) |>
mutate(ttt=as.factor(case_when(poll_treat==1~"low",
poll_treat==2~"medium",
TRUE~"high"))) |>
mutate(ttt=forcats::fct_relevel(ttt, c("low","medium","high")))
# proportion non-aborted
data_proxy_ovav <- data_flower %>%
filter(is.na(nbAv)|is.na(nbGr_SR))) %>%
# proportion non-aborted
data_proxy_ovav <- data_flower %>%
filter(!(is.na(nbAv)|is.na(nbGr_SR))) %>%
group_by(id,session,ttt) %>%
summarise(nb_ab_sum_ab=sum(nbAv,na.rm=T),
nb_seed_sum_ab=sum(nbGr_SR,na.rm=T))
# proportion non-aborted
data_proxy_ovav <- data_flower %>%
filter(!(is.na(nbAv)|is.na(nbGr_SR))) %>%
group_by(ID_full,session,ttt) %>%
summarise(nb_ab_sum_ab=sum(nbAv,na.rm=T),
nb_seed_sum_ab=sum(nbGr_SR,na.rm=T))
data_proxy_ovav
# seed-set
data_proxy_ss <- data_flower %>%
filter(!(is.na(nbOv)|is.na(nbGr_SR))) %>%
group_by(ID_full,session,ttt) %>%
summarise(nb_ov_sum_ss=sum(nbOv,na.rm=T),
nb_seed_sum_ss=sum(nbGr_SR,na.rm=T))
data_proxy_ss
data_flower <- read.table(file_path,head=T) |>
mutate(ttt=as.factor(case_when(poll_treat==1~"low",
poll_treat==2~"medium",
TRUE~"high"))) |>
mutate(ttt=forcats::fct_relevel(ttt, c("low","medium","high"))) |>
rename(ID_full = id)
data_flower$nbGr_semis
data_flower$poids_sd
# proportion non-aborted
data_proxy_ab <- data_flower %>%
filter(!(is.na(nbAv)|is.na(nbGr_SR))) %>%
group_by(ID_full,session,ttt) %>%
summarise(nb_ab_sum_ab=sum(nbAv,na.rm=T),
nb_seed_sum_ab=sum(nbGr_SR,na.rm=T))
# seed-set
data_proxy_ss <- data_flower %>%
filter(!(is.na(nbOv)|is.na(nbGr_SR))) %>%
group_by(ID_full,session,ttt) %>%
summarise(nb_ov_sum_ss=sum(nbOv,na.rm=T),
nb_seed_sum_ss=sum(nbGr_SR,na.rm=T))
# proportion germinated
data_proxy_germ <- data_flower %>%
filter(!(is.na(nbGr_semis)|is.na(nbGr_germ))) %>%
group_by(ID_full,session,ttt) %>%
summarise(nb_sown_sum_germ=sum(nbGr_semis,na.rm=T),
nb_germ_sum_germ=sum(nbGr_germ,na.rm=T))
# proportion germinated
data_proxy_weight <- data_flower %>%
group_by(ID_full,session,ttt) %>%
summarise(mean_seed_weight=mean(poids_sd,na.rm=T))
data_proxy_id <- data_proxy_ab |>
full_join(data_proxy_ss)
data_proxy_id
data_proxy_id <- data_proxy_ab |>
full_join(data_proxy_ss) |>
full_join(data_proxy_germ) |>
full_join(data_proxy_weight)
View(data_proxy_id)
data_proxy_id <- data_proxy_ab |>
full_join(data_proxy_ss) |>
full_join(data_proxy_germ) |>
full_join(data_proxy_weight) |>
mutate_all(~ifelse(is.nan(.), NA, .))
data_proxy_id <- data_proxy_ab |>
full_join(data_proxy_ss) |>
full_join(data_proxy_germ) |>
full_join(data_proxy_weight) |>
mutate_at(~ifelse(is.nan(.), NA, .))
data_proxy_id <- data_proxy_ab |>
full_join(data_proxy_ss) |>
full_join(data_proxy_germ) |>
full_join(data_proxy_weight) |>
ungroup() |>
mutate_all(~ifelse(is.nan(.), NA, .))
data_proxy_id <- data_proxy_ab |>
full_join(data_proxy_ss) |>
full_join(data_proxy_germ) |>
full_join(data_proxy_weight) |>
ungroup() |>
mutate_all(~ifelse(is.nan(.), NA, .)) |>
filter(if_any(everything(), ~ !is.na(.)))
data_proxy_id <- data_proxy_ab |>
full_join(data_proxy_ss) |>
full_join(data_proxy_germ) |>
full_join(data_proxy_weight) |>
ungroup() |>
mutate_all(~ifelse(is.nan(.), NA, .)) |>
filter(if_any(4:10, ~ !is.na(.)))
data_flower <- read.table(file_path,head=T) |>
mutate(ttt=as.factor(case_when(poll_treat==1~"low",
poll_treat==2~"medium",
TRUE~"high"))) |>
mutate(ttt=forcats::fct_relevel(ttt, c("low","medium","high"))) |>
rename(nb_ab = nbAv,
nb_ov = nbOv,
nb_seed = nbGr_SR,
seed_weight = poids_sd,
germ = nbGr_germ,
sown = nbGr_semis)
data_flower <- read.table(file_path,head=T) |>
mutate(ttt=as.factor(case_when(poll_treat==1~"low",
poll_treat==2~"medium",
TRUE~"high"))) |>
mutate(ttt=forcats::fct_relevel(ttt, c("low","medium","high"))) |>
rename(nb_ab = nbAv,
nb_ov = nbOv,
nb_seed = nbGr_SR,
seed_weight = poids_sd,
germ = nbGr_germ,
sown = nbGr_semis)
# proportion non-aborted
data_proxy_ab <- data_flower %>%
filter(!(is.na(nb_ab)|is.na(nb_seed))) %>%
group_by(ID_full,session,ttt) %>%
summarise(nb_ab_sum_ab=sum(nbAv,na.rm=T),
nb_seed_sum_ab=sum(nbGr_SR,na.rm=T))
# proportion non-aborted
data_proxy_ab <- data_flower %>%
filter(!(is.na(nb_ab)|is.na(nb_seed))) %>%
group_by(ID_full,session,ttt) %>%
summarise(nb_ab_sum_ab=sum(nb_ab,na.rm=T),
nb_seed_sum_ab=sum(nb_seed,na.rm=T))
# proportion germinated
data_proxy_germ <- data_flower %>%
filter(!(is.na(nb_sown)|is.na(nb_germ))) %>%
group_by(ID_full,session,ttt) %>%
summarise(nb_sown_sum_germ=sum(nb_sown,na.rm=T),
nb_germ_sum_germ=sum(nb_germ,na.rm=T))
data_flower <- read.table(file_path,head=T) |>
mutate(ttt=as.factor(case_when(poll_treat==1~"low",
poll_treat==2~"medium",
TRUE~"high"))) |>
mutate(ttt=forcats::fct_relevel(ttt, c("low","medium","high"))) |>
rename(nb_ab = nbAv,
nb_ov = nbOv,
nb_seed = nbGr_SR,
seed_weight = poids_sd,
nb_germ = nbGr_germ,
nb_sown = nbGr_semis)
# proportion germinated
data_proxy_germ <- data_flower %>%
filter(!(is.na(nb_sown)|is.na(nb_germ))) %>%
group_by(ID_full,session,ttt) %>%
summarise(nb_sown_sum_germ=sum(nb_sown,na.rm=T),
nb_germ_sum_germ=sum(nb_germ,na.rm=T))
# proportion germinated
data_proxy_weight <- data_flower %>%
group_by(ID_full,session,ttt) %>%
summarise(mean_seed_weight=mean(mean_seed,na.rm=T))
# proportion germinated
data_proxy_weight <- data_flower %>%
group_by(ID_full,session,ttt) %>%
summarise(mean_seed_weight=mean(seed_weight,na.rm=T))
data_proxy_id <- data_proxy_ab |>
full_join(data_proxy_ss) |>
full_join(data_proxy_germ) |>
full_join(data_proxy_weight) |>
ungroup() |>
mutate_all(~ifelse(is.nan(.), NA, .)) |> # for id without seed weight
filter(if_any(4:10, ~ !is.na(.))) # remove id without data
data_proxy_id
